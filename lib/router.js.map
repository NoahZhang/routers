{"version":3,"sources":["..\\dist\\router.js"],"names":[],"mappings":"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","file":"dist/router.js","sourcesContent":["import HttpError from 'http-errors'\r\nimport methods from 'methods'\r\nimport Route from './route'\r\n\r\nexport default class Router{\r\n  constructor(app, opts) {\r\n    if(app && !app.use) {\r\n      opts = app;\r\n      app = null;\r\n    }\r\n\r\n    this.opts = opts || {};\r\n    this.methods = this.opts.methods || [\r\n      'HEAD',\r\n      'OPTIONS',\r\n      'GET',\r\n      'PUT',\r\n      'PATCH',\r\n      'POST',\r\n      'DELETE'\r\n    ];\r\n\r\n    this.params = {};\r\n    this.stack = {\r\n      middleware: [],\r\n      routes: []\r\n    };\r\n\r\n    if(app) this.extendApp(app);\r\n\r\n    methods.forEach(method => {\r\n      this[method] = function(name, path, middleware) {\r\n        var args = Array.prototype.slice.call(arguments);\r\n        if((typeof path === 'string') || (path instanceof RegExp)) {\r\n          args.splice(2, 0, [method]);\r\n        } else {\r\n          args.splice(1, 0, [method]);\r\n        }\r\n\r\n        this.register.apply(this, args);\r\n        return this;\r\n      }\r\n    });\r\n  }\r\n\r\n  use(middleware) {\r\n    this.stack.middleware.push.apply(this.stack.middleware, arguments);\r\n    return this;\r\n  }\r\n\r\n  prefix(prefix) {\r\n    this.opts.prefix = prefix;\r\n\r\n    this.stack.routes.forEach(route => {\r\n      route.setPrefix(prefix);\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  routes() {\r\n    var router = this;\r\n\r\n    return function *dispatch(next) {\r\n      var method = this.method;\r\n      var path = router.opts.routerPath || this.routerPath || this.path;\r\n      var matched = router.match(path);\r\n      var route = matched.filter(route => {\r\n        return ~route.methods.indexOf(method);\r\n      }).shift();\r\n\r\n      if(this.matched) {\r\n        this.matched.push.apply(this.matched, matched);\r\n      } else {\r\n        this.matched = matched;\r\n      }\r\n\r\n      if(route) {\r\n        this.captures = route.captures(path);\r\n        this.params = route.params(path, this.captures);\r\n        this.route = route;\r\n\r\n        next = this.route.middleware.call(this, next);\r\n\r\n        for(let i = router.stack.middleware.length - 1; i >= 0; --i) {\r\n          next = router.stack.middleware[i].call(this, next);\r\n        }\r\n\r\n        yield *next;\r\n      } else {\r\n        return yield *next;\r\n      }\r\n    }\r\n  }\r\n\r\n  middleware() {\r\n    return this.routes();\r\n  }\r\n\r\n  allowedMethods(options) {\r\n    options = options || {};\r\n    var implemented = this.methods;\r\n\r\n    return function *allowedMethods(next) {\r\n      yield *next;\r\n\r\n      var allowed = {};\r\n\r\n      if(!this.status || this.status === 404) {\r\n        this.matched.forEach(route => {\r\n          route.methods.forEach(method => {\r\n            allowed[method] = method;\r\n          });\r\n        });\r\n\r\n        var allowedArr = Object.keys(allowed);\r\n\r\n        if (!~implemented.indexOf(this.method)) {\r\n          if(options.throw) {\r\n            throw new HttpError.NotImplemeted();\r\n          } else {\r\n            this.status = 501;\r\n            this.set('Allow', allowedArr);\r\n          }\r\n        } else if (allowedArr.length) {\r\n          if (this.method === 'OPTIONS') {\r\n            this.status = 204;\r\n          } else if(!allowed[this.method]) {\r\n            if (options.throw) {\r\n              throw new HttpError.MethodNotAllowed();\r\n            } else {\r\n              this.status = 405;\r\n            }\r\n          }\r\n          this.set('Allow', allowedArr);\r\n        }\r\n      }\r\n    };\r\n  }\r\n\r\n  all(name, path, middleware) {\r\n    var args = Array.prototype.slice.call(arguments);\r\n    args.splice(typeof path === 'function' ? 1 : 2, 0, methods);\r\n\r\n    this.register.apply(this, args);\r\n    return this;\r\n  }\r\n\r\n  redirect(source, destination, code) {\r\n    if (source instanceof RegExp || source[0] != '/') {\r\n      source = this.url(source);\r\n    }\r\n\r\n    if (destination instanceof RegExp || destination[0] != '/') {\r\n      destination = this.url(destination);\r\n    }\r\n\r\n    return this.all(source, function *(){\r\n      this.redirect(destination);\r\n      this.status = code || 301;\r\n    });\r\n  }\r\n\r\n  register(name, path, methods, middleware) {\r\n    if(path instanceof Array) {\r\n      middleware = Array.prototype.slice.call(arguments, 2);\r\n      methods = path;\r\n      path = name;\r\n      name = null;\r\n    } else {\r\n      middleware = Array.prototype.slice.call(arguments, 3);\r\n    }\r\n\r\n    var route = new Route(path, methods, middleware, name, this.opts);\r\n\r\n    if(this.opts.prefix) {\r\n      route.setPrefix(this.opts.prefix);\r\n    }\r\n\r\n    Object.keys(this.params).forEach(param => {\r\n      route.param(param, this.params[param]);\r\n    }, this);\r\n\r\n    this.stack.routes.push(route);\r\n\r\n    return route;\r\n  }\r\n\r\n  route(name) {\r\n    var routes = this.stack.routes;\r\n\r\n    for(let len = routes.length, i = 0; i<len; i++) {\r\n      if(routes[i].name === name) {\r\n        return routes[i];\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  url(name, params) {\r\n    var route = this.route(name);\r\n\r\n    if(route) {\r\n      var args = Array.prototype.slice.call(arguments, 1);\r\n      return route.url.apply(route, args);\r\n    }\r\n\r\n    return new Error(\"No route found for name: \" + name);\r\n  }\r\n\r\n  match(path) {\r\n    var routes = this.stack.routes;\r\n\r\n    var matched = [];\r\n\r\n    for(let len = routes.length, i = 0; i < len; i++) {\r\n      if(routes[i].match(path)) {\r\n        matched.push(routes[i]);\r\n      }\r\n    }\r\n\r\n    return matched;\r\n  }\r\n\r\n  param(param, middleware) {\r\n    this.params[param] = middleware;\r\n    this.stack.routes.forEach(route => {\r\n      route.param(param, middleware);\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  extendApp(app) {\r\n    var router = this;\r\n\r\n    app.url = router.url.bind(router);\r\n    app.router = router;\r\n\r\n    ['all', 'redirect', 'register', 'del', 'param']\r\n    .concat(methods)\r\n    .forEach(method => {\r\n      app[method] = function() {\r\n        router[method].apply(router, arguments);\r\n        return this;\r\n      };\r\n    });\r\n\r\n    return app;\r\n  }\r\n}\r\n"]}